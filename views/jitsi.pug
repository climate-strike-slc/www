extends layout
block page
	- var menu = 'meetings'
block content
	script(type="text/javascript" src="/scripts/jquery.min.js")
	script(src="/scripts/strophe/strophe.js")
	script(src="/scripts/strophe/strophe.disco.min.js?v=1")
	script(type="text/javascript", src="/scripts/baseFunctions.js?v="+Math.random())
	script(type="text/javascript", src="/scripts/jitsiFunctions.js?v="+Math.random())

	div#vue
		div.nav
			include partials/menu.pug
		
		div.wrapper(
			v-if="data && data !== '' && data.length > 0"
			v-for="(year, y) in years",
		)
			div.main(
				v-for="(month, m) in months"
				style="pointer-events: none;"
			)
				div.container(
					v-for="(date, m) in days"
					:class="(!active ? '' : 'active')"
					style="pointer-events:none;"
				)
					div.ui(v-text="monthtext[month]+' '+date+', '+year")
					div.ui.img(
						v-for="(doc, i) in data"
						v-if="(new Date(doc.start_time).getDate() === date)"
						@click="dialog(i, $event)"
						@mouseover="hover"
						@mouseleave="unhover"
						@touchstart="hover"
						@touchend="dialog(i)"
						:class="i === parseInt(active,10) ? 'active' : ''"
						:id="'meeting'+i"
						:style="{'background-color': (!doc ? c[i] : c[cats.indexOf(doc.topic)]) }"
						style="pointer-events: auto;"
					)
						//- https://zoom.us/wc/{{ meetindID }}/join?prefer=1&un={{ base64Encoded Name }} 
						//- embed(
						//- 	v-if="!isFirefox && !isSafari && i === parseInt(active,10)"
						//- 	:height="(!res ? ((wWidth * 0.66) * 0.72) : 400)"
						//- 	:width="(!res ? wWidth * 0.66 : wWidth)" 
						//- 	type="text/html" 
						//- 	style="pointer-events:all; z-index: 2; position: relative;" 
						//- 	:src="'https://bli.sh/'+data[i].title.split(' ').join('_')"
						//- 	)
						//- iframe(v-if="k === active" :src="'/meeting/'+data[i].id")
						div.row(v-if="i !== parseInt(active,10)" style="position:relative;z-index:1;")
							div.tb-10-m0
								p(v-html="marked('# '+moment(data[i].start_time).format('LT'))")
								p(v-if="data && data[i].title" v-html="data[i].title" style="color: #555;")
								p(v-if="data && data[i].description" v-html="marked(data[i].description)")
							//- div.tb-10-m0
							//- 	div.row
							//- 		div.tb-05-m0
							//- 			a.fit(@click="deactivate(i)" role="button" target="_blank" :href="data[i].join_url" v-text="'Join in Zoom app'")
							//- 			//- a(:href="'/mtg/meeting/'+data[i].id")
							//- 		div.tb-05-m0
							//- 			a.fit(role="button" :href="'/api/editMeeting/'+ doc.id") Edit
						img(v-if="i !== parseInt(active,10)" :src="'/images/icons/'+data[i].topic+'.svg'" style="width:100%; top:0; left:0; position:absolute; z-index: 0;opacity:0.4;")
						a(v-if="pu && pu.properties.admin" :href="'/api/deleteMeeting/'+data[i].id" v-text="'x'" style="z-index: 3; position: absolute;")

		//- div#meet
		//- 	embed(v-if="!isSafari" :height="(!res ? ((wWidth * 0.66) * 0.72) : 400)" :width="(!res ? wWidth * 0.66 : wWidth)" type="text/html" style="pointer-events:all; z-index: 2; position: relative;" :src="'https://bli.sh/Tryingthisout'")
			//- a(href="#" @click="unload()") Unload
			//- a(href="#" @click="switchVideo()") switchVideo
			//- div#audioOutputSelectWrapper(style="display: none;") 
			//- 	span Change audio output device
			//- 	select#audioOutputSelect(@change="changeAudioOutput")
	include vue/jitsi.vue.pug